# Maintainer: Axilleas Pipinellis <axilleas@archlinux.gr>

pkgname=python2-kamaki-git
pkgver=20121206
pkgrel=1
pkgdesc="A command-line tool for managing clouds."
arch=(any)
url="http://code.grnet.gr/projects/kamaki"
license=('BSD')
depends=('python2-snf-common>=0.10')
makedepends=('git' 'python2-distribute')
optdepends=('python2-ansicolors: for color support' 'python2-progress>=1.0.2: for progress bar support')

_gitroot="https://code.grnet.gr/git/kamaki"
_gitname="kamaki"

build() {

  cd "$srcdir"
  	msg "Connecting to GIT server...."

  if [[ -d $srcdir/$_gitname ]] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

	msg "GIT checkout done"
	msg "Starting make..."

	git clone $srcdir/$_gitname $srcdir/$_gitname-build

	#fix python2 issues
	cd $srcdir/$_gitname-build/$_gitname
	sed -i 's|#!/usr/bin/env python|#!/usr/bin/env python2|' *.py 
	
	cd $srcdir/$_gitname-build/
	python2 setup.py install --root="${pkgdir}" -O1
} 
